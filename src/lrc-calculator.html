<!doctype html>
<html>
    <head>
        <title>LRC Service Cost Calculator</title>
        <meta name="description" content="Laboratory Research Computing Services Cost Calculator" />
        <link href="../dist/output.css" rel="stylesheet" />
        <script src="lrc-calculator.js" type="text/javascript"></script>
        <script src="https://unpkg.com/htmx.org@1.9.9" integrity="sha384-QFjmbokDn2DjBjq+fM+8LUIVrAgqcNW2s0PjAxHETgRn9l4fvX31ZxDxvwQnyMOX" crossorigin="anonymous"></script>
    </head>
<body>
    <div class="grid lg:grid-cols-2 p-10">
        <div class="p-4">
            <h1 class="text-2xl font-bold m-2">LRC Jobscript Tool</h1>
            <form onSubmit="return (calculate_lrc_cost() && false)">

                <!-- account information -->
                <div class="m-2 p-2 border-2 bg-gray-800">
                    <h1 class="text-lg font-bold m-0">Account Information</h1>
                    <label class="form-control w-full m-2">
                        <div class="label">
                          <span class="label-text">Project Account Name (e.g. ac_scsguest)</span>
                        </div>
                        <input name="project" type="text" placeholder="" class="input input-bordered w-full max-w-xs" />
                    </label>
                </div>

                <!-- machine information -->
                <div class="m-2 p-2 border-2 bg-gray-800">
                <h1 class="text-lg font-bold m-0">Machine Information</h1>
                <label class="form-control w-max m-2">
                    <div class="label">
                      <span class="label-text">Cluster Partition (Node Type)</span>
                    </div>
                    <select name="partition" class="select select-bordered">
                      <option disabled selected>Select...</option>
                      <option>LR3 (XEON E5-2670v1/v2 / 16-20 core / 64GB - Free)</option>
                      <option>LR4 (XEON E5-2670v3 / 24 core / 64GB - 0.5 SU/core/hr)</option>
                      <option>LR5 (XEON E5-2680v4 / 20-28 core / 64/128GB - 0.75 SU/core/hr)</option>
                      <option>LR6 (XEON Gold 5218/6130/6230 / 32-40 core / 96-128GB - 1.0 SU/core/hr)</option>
                      <option>LR7 (XEON Gold 6330 Gold 32-40 core / 96-128GB - 1.0 SU/core/hr)</option>
                      <option>LR_BIGMEM (Xeon Gold 5821 32 core / 1548GB - 1.5 SU/core/hr)</option>
                      <option>ES1:2080TI (Xeon Silver 4212 / 8 core / 96GB / 4x NVIDIA 2080TI - 2.0 SU/gpu/hr)</option>
                      <option>ES1:V100 (Xeon E5-2623 / 8 core / 64GB / 2x NVIDIA V100 - 4.0 SU/gpu/hr)</option>
                      <option>ES1:A40 (AMD EPYC 7742 / 64 core / 512GB / 4x NVIDIA A40 - 16.0 SU/gpu/hr)</option>
                    </select>
                </label>

                <label class="form-control w-max m-2">
                    <div class="label">
                      <span class="label-text">Service Level (QOS)</span>
                    </div>
                    <select name="qos" class="select select-bordered">
                      <option disabled selected>Select...</option>
                      <option value="normal">Normal</option>
                      <option value="debug">Debug (1 hour limit)</option>
                      <option value="lowprio">Low-Priority (Preemptable)</option>
                      <option value="condo">Condo Account (Specify Below)</option>
                    </select>
                </label>
                
                <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Condo Account Name (e.g. nano, jgi, ...)</span>
                    </div>
                    <input name="condo" type="text" placeholder="" class="input input-bordered w-full max-w-xs" />
                </label>

                <label class="form-control w-max m-2">
                    <div class="label">
                      <span class="label-text">Number of Nodes (Max 32)</span>
                    </div>
                    <input value="1" name="n_nodes" type="number" min="1" max="32" class="input input-bordered w-full max-w-xs" />
                </label>
                
                <label class="form-control w-max m-2">
                    <div class="label">
                      <span class="label-text">Number of Cores per Node</span>
                    </div>
                    <input value="" name="n_cores" type="number" min="1" max="32" class="input input-bordered w-full max-w-xs" />
                </label>
                
                <label class="form-control w-max m-2">
                    <div class="label">
                      <span class="label-text">Number of GPUs per Node</span>
                    </div>
                    <input value="" name="n_gpus" type="number" min="1" max="32" class="input input-bordered w-full max-w-xs" />
                </label>
                
                </div><!-- end machine information -->



                <!-- thread binding -->
                <div class="m-2 p-2 border-2 bg-gray-800">
                    <h1 class="text-lg font-bold m-0">Thread Binding Parameters</h1>
                    <label class="form-control w-max m-2">
                        <div class="label">
                          <span class="label-text">Thread Layout</span>
                        </div>
                        <select name="partition" class="select select-bordered">
                          <option disabled selected>Select...</option>
                          <option>Spread (Optimal for Memory Bandwidth)</option>
                          <option>Close (Optimal for Cache Locality)</option>
                        </select>
                    </label>
    
                    <label class="form-control w-max m-2">
                        <div class="label">
                          <span class="label-text">Processes per Node</span>
                        </div>
                        <input name="n_tasks" type="number" min="1" max="64" class="input input-bordered w-full max-w-xs" />
                    </label>
                    
                    <label class="form-control w-max m-2">
                        <div class="label">
                          <span class="label-text">Threads per Process</span>
                        </div>
                        <input name="n_tasks" type="number" min="1" max="64" class="input input-bordered w-full max-w-xs" />
                    </label>
                    
                </div><!-- end thread binding information -->

                <div class="m-2 p-2 border-2 bg-gray-800">

                <h1 class="text-lg font-bold m-0">Job Information</h1>

                <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Command to Run (e.g. /path/to/myapp arg1 arg2 arg3)</span>
                    </div>
                    <input name="command" type="text" placeholder="" class="input input-bordered w-full max-w-xs" />
                </label>
                  
                <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Module Dependencies</span>
                    </div>
                    <div class="pr-4">
                    <textarea name="modules" class="textarea textarea-bordered w-full" placeholder=""></textarea>
                    </div>
                </label>
                  
                <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Name of Job (e.g. mytask1)</span>
                    </div>
                    <input name="name" type="text" placeholder="" class="input input-bordered w-full max-w-xs" />
                </label>
                  
                <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Notification E-mail Address</span>
                    </div>
                    <input name="email" type="text" placeholder="" class="input input-bordered w-full max-w-xs" />
                </label>

                <h1 class="text-sm pt-4 m-2">Job Runtime (Wallclock Time Limit)</h1>

                <div class="px-2">
                    <label class="form-control w-full m-2">
                    <div class="label">
                      <span class="label-text">Hours</span>
                    </div>

                    <input type="range" name="hours" min="0" max="72" value="0" class="range pr-4" />
                    <div class="w-md p-2 flex justify-between text-xs px-2 pr-4">
                        <span>0</span>
                        <span>12</span>
                        <span>24</span>
                        <span>36</span>
                        <span>48</span>
                        <span>60</span>
                        <span>72</span>
                      </div>
                    </label>
                  
                    <label class="form-control w-full m-2">
                        <div class="label">
                        <span class="label-text">Minutes</span>
                        </div>

                        <input type="range" name="minutes" min="0" max="60" value="30" class="range pr-4" />
                        <div class="w-md p-2 flex justify-between text-xs px-2 pr-4">
                            <span>0</span>
                            <span>10</span>
                            <span>20</span>
                            <span>30</span>
                            <span>40</span>
                            <span>50</span>
                            <span>60</span>
                        </div>
                    </label>

                    <label class="form-control w-full m-2">
                        <div class="label">
                        <span class="label-text">Seconds</span>
                        </div>

                        <input type="range" name="seconds" min="0" max="59" value="0" class="range pr-4" />
                        <div class="w-md p-2 flex justify-between text-xs px-2 pr-4">
                            <span>0</span>
                            <span>10</span>
                            <span>20</span>
                            <span>30</span>
                            <span>40</span>
                            <span>50</span>
                            <span>59</span>
                        </div>
                    </label>
                    
                </div>

                </div><!-- end job information -->

                <div class="p-2">
                <input class="btn btn-primary p-2 w-full" name="submit" type="submit" value="Submit"/>
                </div>

            </form>
        </div>
        <div class="p-4">
            <h1 class="text-2xl font-bold m-2">LRC Jobscript Result</h1>

            <div class="m-2 p-2 border-2 bg-gray-600">
                <h1 class="text-lg font-bold m-0">LRC Service Cost</h1>
                <div class="p-2">
                <div class="stats shadow w-full">
                    <div class="stat w-full">
                        <div class="stat-title">Estimated Total Service Units</div>
                        <div class="stat-value">0.0</div>
                    </div>
                </div>
                </div>

            <div class="p-2">
                <div role="alert" class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Each LRC Account Receives 500,000 SU Free per Fiscal Year</span>
                </div>
            </div>

            <div class="p-2">
                <div role="alert" class="alert alert-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Exact SU Cost Depends on Number of Cores and Actual Job Runtime</span>
                </div>
            </div>

            </div>

            <div class="m-2 p-2 border-2 bg-gray-800">
                <h1 class="text-lg font-bold m-0">SLURM Batch File</h1>
                <div class="mockup-code m-2">
                    <pre data-prefix="1"><code>npm i daisyui</code></pre> 
                    <pre data-prefix="2"><code>installing...</code></pre> 
                    <pre data-prefix="3"><code>Error!</code></pre>
                </div>
            </div>

            <div class="m-2 p-2 border-2 bg-gray-800">
                <h1 class="text-lg font-bold m-0">srun Command</h1>
                <div class="mockup-code m-2">
                    <pre data-prefix="$"><code>npm i daisyui</code></pre> 
                </div>
            </div>
            
        </div>     
    </div>

    <script>
        console.log(calculate_lrc_cost('lr4', 1, 1, 0, 'v100', 'normal', 1, 0))
    </script>
</body>
</html>